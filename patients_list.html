{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Пациенты</h1>
  {% if current_user.role == 'admin' %}
    <a class="btn btn-primary" href="{{ url_for('patient_create') }}">Добавить пациента</a>
  {% endif %}
</div>
<table class="table table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>ФИО</th>
      <th>ДР</th>
      <th>Телефон</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for p in patients %}
    <tr>
      <td>{{ p.id }}</td>
      <td><a href="{{ url_for('patient_detail', patient_id=p.id) }}">{{ p.first_name }} {{ p.last_name }}</a></td>
      <td>{{ p.birth_date.strftime('%d.%m.%Y') if p.birth_date else '' }}</td>
      <td>{{ p.phone }}</td>
      <td>
        {% if current_user.role == 'admin' %}
          <a class="btn btn-sm btn-secondary" href="{{ url_for('patient_edit', patient_id=p.id) }}">Ред.</a>
          <form method="post" action="{{ url_for('patient_delete', patient_id=p.id) }}" style="display:inline" onsubmit="return confirm('Удалить пациента?');">
            <button class="btn btn-sm btn-danger" type="submit">Удал.</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr><td colspan="5">Пациенты не найдены.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
